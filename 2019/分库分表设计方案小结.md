## 本节大纲
* [一、为什么分库分表](#1)
* [二、如何分库分表](#2)
* [三、分库分表查询](#3)
* [四、小结](#4)



## <span id="1">一、为什么分库分表</span>
**数据库瓶颈**：数据库连接池大小
* IO瓶颈
  - 磁盘：热点数据太大，数据库buffer pool容量有限，需要访问磁盘页上数据
  - 网络：网络带宽大小受限
* cpu瓶颈：耗时sql；不合理索引；非聚集索引

一般什么情况下分库分表的：
* 单库存储超过100G+
* 单表条数1亿+
* 每天新增百万条记录
## <span id="2">二、如何分库分表</span>

 大多数场景下分库分表选取的字段就是查询的字段且数值类型，一般user_id。
* 水平分库分表：
   *水平分库*：按照字段(user_id或者obj_id业务id)hash将数据拆分到不同库
   *水平分表*：按照字段(user_id或者obj_id业务id)hash将数据拆分到不同表，

* 垂直分库分表：
   *垂直分库* ：按照业务表为单位，垂直拆分(微服务)；例如：订单库、用户库 
   *垂直分表* ：按照字段是否热点(活跃性)，同一个业务表热点字段与非热点字段拆分；例如：用户库(主表存储用户基本信息、辅助表存放用户扩展属性地址、星座等)
   
* 分布式数据库中间件：
  一般分 proxy和客户端两种。前者有MyCat等  后者Sharding_JDBC等
## <span id="3">三、分库分表查询</span>
场景比如按照userID分表存储订单信息，现在拿着orderID做查询，方案如下：
  - 1.存储主表后，再冗余存储索引辅助表，表信息 user_id、order_id，查询时先查询索引表，再查询主表
  - 2.redis存储索引辅助表
  - 3.冗余双份数据，数据最终一致性，此方案占用存储较大


## <span id="4">四、小结</span>
* 根据业务选择垂直or水平拆分
* 拆分ID保证分配均匀，选择合适的字段值
